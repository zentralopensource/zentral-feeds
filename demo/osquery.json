{
  "name": "Osquery demo",
  "description": "Demonstrate some of the osquery functionalities and the integration with Zentral.",
  "id": "io.zentral.demo.osquery",
  "probes": {
    "distributed-101": {
      "model": "OsqueryDistributedQueryProbe",
      "name": "Simple distributed query",
      "description": "Gather some info from the enrolled osquery clients.",
      "body": {
        "distributed_query": "select * from osquery_info;"
      }
    },
    "fim-101": {
      "model": "OsqueryFIMProbe",
      "name": "Monitor the .ssh folders",
      "description": "File integrity monitoring of the .ssh folders with osquery.\nhttps://osquery.readthedocs.io/en/stable/deployment/file-integrity-monitoring/",
      "body": {
        "file_paths": [
          {
            "file_access": false,
            "file_path": "/home/%/.ssh/"
          },
          {
            "file_access": false,
            "file_path": "/Users/%/.ssh/"
          },
          {
            "file_access": false,
            "file_path": "/root/.ssh/"
          }
        ]
      }
    },
    "debug": {
      "model": "BaseProbe",
      "name": "Osqueryd clients logs",
      "description": "The status logs posted by the osqueryd clients",
      "body": {
        "filters": {
          "metadata": [
            {
              "event_types": [
                "osquery_status"
              ]
            }
          ]
        }
      }
    },
    "cis-security-benchmarks-for-macos": {
      "model": "OsqueryComplianceProbe",
      "name": "CIS Security Benchmarks for macOS",
      "description": "Check several recommendations from CIS security benchmarks for Apple security\r\n\r\nhttps://benchmarks.cisecurity.org/tools2/osx/CIS_Apple_OSX_10.12_Benchmark_v1.0.0.pdf",
      "body": {
        "preference_files": [
          {
            "description": "CIS Guideline: 2.1.1 Bluetooth off",
            "interval": 3600,
            "keys": [
              {
                "key": "ControllerPowerState",
                "value": "0"
              }
            ],
            "rel_path": "com.apple.Bluetooth.plist",
            "type": "GLOBAL"
          },
          {
            "description": "CIS Guideline: 6.1.3 Disable Guest Account",
            "interval": 3600,
            "keys": [
              {
                "key": "GuestEnabled",
                "value": "NO"
              }
            ],
            "rel_path": "com.apple.loginwindow.plist",
            "type": "GLOBAL"
          },
          {
            "description": "CIS Guideline: 6.3 Disable Safari safe file opening",
            "interval": 3600,
            "keys": [
              {
                "key": "AutoOpenSafeDownloads",
                "value": "NO"
              }
            ],
            "rel_path": "com.apple.Safari.plist",
            "type": "USERS"
          },
          {
            "description": "CIS Guideline: 2.6.3 Enable Firewall",
            "interval": 3600,
            "keys": [
              {
                "key": "globalstate",
                "value": "1"
              }
            ],
            "rel_path": "com.apple.alf.plist",
            "type": "GLOBAL"
          }
        ]
      }
    },
    "usb-block-devices": {
      "model": "OsqueryProbe",
      "name": "USB storage devices",
      "description": "Log the connections of USB block_devices.",
      "body": {
        "queries": [
          {
            "interval": 60,
            "query": "select * FROM block_devices AS bd JOIN mounts AS m WHERE m.device = bd.name AND bd.type = 'USB';",
            "removed": false
          }
        ]
      }
    }
  }
}
